<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <title>PCB Defect Classifier</title>
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
</head>

<body>

    <!-- Navigation bar -->
    <div class="shadower"></div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/">PCB DEFECT CLASSIFIER</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </nav>
    <div class="container my-2">
        <a href="/mainpage/<%= defectId %>"> <button type="button" class="btn btn-primary"  style="margin-top: 20px;"><i class="fas fa-arrow-left" style="margin-right: 10px;"></i>Back</button></a>
    </div>

        <div class="container">
            <h2 class="text-center" style="margin-bottom: 25px;">DEFECT REPORT</h2>
            <div class="container">
                <div class="row">
                    <div class="col-12 col-md-6" style="height: 400px;">
                        <%if(data.length!=0){%>
                            <img id="first" src="/web/display_comb_cntrs/<%=data[0]%>" style="border:2px solid black;" alt="white_errors" width="99%" height="99%">
                            <%}%>
                    </div>
                    <div class="col-12 col-md-6" style="height: 400px;">
                        <%if(data.length!=0){%>
                            <img id="second" src="/web/display_comb_cntrs/<%=data[1]%>" style="border:2px solid black;" alt="white_errors" width="99%" height="99%">
                        <%}%>
                    </div>
                </div>
            </div>
        </div>
        <h4 class="text-center"  style="margin-top: 25px;"><span style="border-bottom:1px solid black; padding-bottom:8px">Localised Defects<i class="fas fa-arrow-up" style="margin-left: 10px;"></i></span></h4>
        <br>
        <br>
        <div class="container">
            <div class="row">
                <div class="recorder hider" about="<%=error_count[0]%>"></div>
                <div class="recorder hider" about="<%=error_count[1]%>"></div>
                <div class="recorder hider" about="<%=error_count[2]%>"></div>
                <div class="recorder hider" about="<%=error_count[3]%>"></div>
                <div class="recorder hider" about="<%=error_count[4]%>"></div>
                <div class="recorder hider" about="<%=error_count[5]%>"></div>
                <div class="col-md-6">
                    <canvas id="myChart" width="400px" height="400px"></canvas>
                </div>
                <div class="col-md-6">
                    <canvas id="myChart1" width="400px" height="400px"></canvas>
                </div>
            </div>
        </div>
        <h4 class="text-center"  style="margin-top: 25px;"><span style="border-bottom:1px solid black; padding-bottom:8px">Statistics<i class="fas fa-arrow-up" style="margin-left: 10px;"></i></span></h4>
    <br>
    <br>
    <div class="container">
        <!-- <h3 class="text-center">FEEDBACK</h3>
        <div class="row">
            <div class="col" style="border-style: solid; border-radius: 5px;">
                <h5 class="text-center">Total Cost</h5>
            </div>
            <div class="col" style="border-style: solid; border-radius: 5px;">
                <h5 class="text-center">Recieved CLassification</h5>
            </div>
            <div class="col" style="border-style: solid; border-radius: 5px;">
                <h5 class="text-center">Generate Classification</h5>
            </div>
        </div>
        <div class="row">
            <div class="col" style="border-style: solid; border-radius: 5px; border-color: cadetblue; height: 250px;">

            </div>
            <div class="col" style="border-style: solid; border-radius: 5px; border-color: cadetblue; height: 250px;">

            </div>
            <div class="col" style="border-style: solid; border-radius: 5px; border-color: cadetblue; height: 250px;">

            </div>
        </div>
        <br> -->
        <div class="row">
            <div class="col-6">
                <form action="/mailer" method="POST">
                    <input class="w-100 mx-0 mail" type="email" name="email" placeholder="example@abc.com">
                    <button class="btn btn-primary w-100 mx-0">Mail Report</button>
                </form>
            </div>
        </div>
        <div class="mt-1">
            <form action="/resetter" method="post">
                <button class="btn btn-primary w-100">Proceed To mainpage</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="p-5 mt-2" style="background-color: #E9E9E9;">
        <div class="row">
            <div class="col-12 col-md">
                <h4>PCB DEFECT CLASSIFIER</h4>
                <h5>Punjab Engineering College</h5>
                <small class="d-block mb-3 text-muted">Â© 2020-2021 PCB DEFECT CLASSIFIER.
                    Electronics And Communication Department. All Rights Reserved.</small>
            </div>
            <div class="col-6 col-md">
                <h5>Follow Us</h5>
                <a class="text-muted" href="#" style="display: inline-block;"><i class="fab fa-facebook fa-2x"></i></a>
                <a class="text-muted" href="#" style="display: inline-block;"><i class="fab fa-instagram fa-2x"></i></a>
            </div>
        </div>
    </footer>

    <!-- Go To Top Button -->
    <a class="gotopbtn" href="#"><i class="fas fa-arrow-up"></i></a>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous" ></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous" ></script>
    <!-- chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script type="text/javascript" async>
        var img1=document.getElementById('first');
        var img2=document.getElementById('second');
        var graph=document.getElementById('myChart');
        var graph1=document.getElementById('myChart1');
        var temp_div=document.getElementsByClassName('shadower')[0];
        var clicked=false;
        var img_selected;
        if(img1!=null)
        {
            img1.addEventListener('click',()=>{
                if(!clicked)
                {
                    clicked=true;
                    img_selected=img1;
                    console.log('Done');
                    img1.style.zIndex='1000';
                    img1.style.transform='scale(0.8)';
                    img1.style.position='fixed';
                    img1.style.top='0';
                    img1.style.right='0';
                    img1.style.transition='transform 0.25s ease';
                    temp_div.style.zIndex='10';
                    temp_div.style.opacity='0.8';
                }  
            });
        }
        if(img2!=null)
        {
            img2.addEventListener('click',()=>{
                if(!clicked)
                {
                    clicked=true;
                    img_selected=img2;
                    console.log('Done');
                    img2.style.zIndex='1000';
                    img2.style.transform='scale(0.8)';
                    img2.style.position='fixed';
                    img2.style.top='0';
                    img2.style.right='0';
                    img2.style.transition='transform 0.25s ease';
                    temp_div.style.zIndex='10';
                    temp_div.style.opacity='0.8';
                }  
            });
        }
        if(graph!=null)
        {
            graph.addEventListener('click',()=>{
                if(!clicked && window.innerWidth>768)
                {
                    clicked=true;
                    img_selected=graph;
                    console.log('Done');
                    graph.style.zIndex='1000';
                    graph.style.transform='scale(1.1)';
                    graph.style.position='fixed';
                    graph.style.top='60px';
                    graph.style.left='300px';
                    graph.style.transition='transform 0.5s ease';
                    temp_div.style.zIndex='10';
                    temp_div.style.opacity='1';
                }  
            });
        }
        if(graph1!=null)
        {
            graph1.addEventListener('click',()=>{
                if(!clicked && window.innerWidth>768)
                {
                    clicked=true;
                    img_selected=graph1;
                    console.log('Done');
                    graph1.style.zIndex='1000';
                    graph1.style.transform='scale(1.1)';
                    graph1.style.position='fixed';
                    graph1.style.top='60px';
                    graph1.style.left='300px';
                    graph1.style.transition='transform 0.5s ease';
                    temp_div.style.zIndex='10';
                    temp_div.style.opacity='1';
                }  
            });
        }
        temp_div.addEventListener('click',()=>{
            if(clicked)
            {
                clicked=false;
                img_selected.style.zIndex=1;
                img_selected.style.transform='scale(1)';
                img_selected.style.position='relative';
                img_selected.style.top='0px';
                img_selected.style.left='0px';
                img_selected.style.transition='transform 0.25s ease';
                temp_div.style.zIndex='-1';
                temp_div.style.opacity='0';
            }
        });

        var firstScroll = false;
        var secondScroll = false;
        var counter_elements=document.getElementsByClassName('recorder');
        if(graph!=null && !firstScroll)
        {
            window.addEventListener('scroll',()=>{
                if(isInViewport(graph) && !firstScroll)
                {
                    grapher(graph,'bar',0.5);
                }
                if(isInViewport(graph1) && !secondScroll)
                {
                    grapher(graph1,'pie',1);
                }       
            });
        }
        function isInViewport(element) {
            const rect = element.getBoundingClientRect();
            return (
                rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
        }
        function grapher(graph,type_graph,opacity) {
            if(counter_elements.length!=0)
            {
                if(type_graph=='bar')
                    firstScroll = true;
                else
                    secondScroll=true;
                graph.style.border="1px solid black";
                var error_data=[];
                for(var i=0;i<counter_elements.length;i++)
                {
                    error_data.push(parseInt(counter_elements[i].getAttribute('about')));
                }
                var myChart = new Chart(graph, {
                    type: type_graph,
                    data: {
                        labels: ['Spur', 'Spurious_Copper', 'Short', 'Mousebite', 'Pinhole', 'Open'],
                        datasets: [{
                            label: 'Count',
                            data: error_data,
                            backgroundColor: [
                                `rgba(255, 99, 132, ${opacity})`,
                                `rgba(54, 162, 235, ${opacity})`,
                                `rgba(255, 206, 86, ${opacity})`,
                                `rgba(75, 192, 192, ${opacity})`,
                                `rgba(153, 102, 255, ${opacity})`,
                                `rgba(255, 159, 64, ${opacity})`
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        hover:{
                            animationDuration: 100
                        },
                        animation:{
                            duration: 1000
                        }
                    }
                });
            }
        }
    </script>
</body>

</html>